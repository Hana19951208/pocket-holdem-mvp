
---

# Pocket Holdem --- 朋友局德州扑克系统 PRD (MVP)

## 一、 产品 PRD (Product Requirement Document)

### 1.1 产品定位

一款极致轻量化的、专为熟人社交设计的**“在线自动发牌器”**。

- **核心逻辑：** 只记分，不涉及任何金融、充值或虚拟货币兑换。
    

### 1.2 产品目标

- **零成本接入：** 无需下载，H5 环境（微信/浏览器）点开即玩。
    
- **极致公平：** 纯服务器端校验逻辑，杜绝前端抓包看牌。
    
- **稳定体验：** 完善的断线重连机制，适配朋友局碎片化操作场景。
    

### 1.3 核心价值

解决线下聚会没有筹码、洗牌慢、计算底池混乱的痛点，提供比商业 App 更私密、无广告、无门槛的竞技环境。

### 1.4 目标用户

- 有线下组局习惯、因异地或时间碎片化需要线上辅助的朋友团体。
    
- 追求纯粹德州竞技，不需要复杂社交和商业功能的硬核玩家。
    

### 1.5 使用场景

- 朋友聚会时，手机化身“筹码栈”与“发牌员”。
    
- 微信语音开黑，网页端同步进行牌局竞技。
    

### 1.6 MVP 范围

- **包含：** 完整德州扑克规则（含**边池算法**）、30秒强制倒计时、房间系统、断线重连、淘汰观战。
    
- **不包含：** 充值、Rebuy（补币）、在线聊天、表情包、战绩统计、多底池回放、AI 机器人。
    

---

## 二、 功能设计说明

### 2.1 房间系统

- **参数设置：** 房主创建时设置“初始筹码”、“大小盲注（如 5/10）”。
    
- **房号管理：** 随机 6 位数字房号，支持链接一键分享。
    
- **席位控制：** 6–9 人桌。房主在游戏未开始前可“踢人”。
    
- **状态管理：** 满员后自动转为“观察者模式”进入。

#### 2.1.1 座位锁定
- **座位锁定：** 游戏进行期间，玩家席位状态锁定。除掉线重连外，不支持位置变更。

### 2.2 玩家系统

- **身份识别：** 仅需输入昵称，系统生成基于 Session/UUID 的唯一 ID。
    
- **淘汰机制：** - **状态流转：** 筹码归零后状态标记为 `Eliminated`（已淘汰）。
    
    - **处理方案：** 玩家**保留在席位上**，但无法参与下一局投注，自动转为“观战状态”。（_注：这满足了你想让大家继续在桌子旁看戏的需求，同时也简化了座位移动的复杂度_）。
        

### 2.3 德州扑克玩法逻辑

- **标准规则：** 两张底牌 + 五张公共牌。
    
- **核心算法：** - **牌型比拼：** 10 种标准牌型自动判定。
    
    - **边池逻辑 (Side Pot)：** **必须实现**。当多名玩家 All-in 且筹码不一致时，自动拆分主池与边池，按贡献度结算。
    - 关于 **"浮点数计算"**：  
		德州扑克虽然通常是整数筹码，但在处理 **Split Pot（平分底池）** 时，可能会出现除不尽的情况（例如 25 筹码 2 人分）。  
		 遇到无法整除的余数（1个筹码），分给**位置最靠前（离庄家最近）**的赢家
        
- **庄位轮换：** 每一局结束后，庄位 (Button) 顺时针移动到下一个**非淘汰**玩家。

>补充说明
>1. 庄位轮换与淘汰： 
当庄位（Button）本该转给 A 玩家，但 A 玩家刚好在本局输光筹码变成了 Eliminated 状态时，我希望庄位是直接跳过他转给 B（跳过淘汰玩家）
>2. 新玩家中途加入： 
如果牌局正在进行，第 7 个朋友进房了。我希望他立刻能坐下（但本局不能玩）即允许随时坐下，但由 GameEngine 标记为 WaitingForNextHand，不给其发牌
>3.新玩家应立即参与盲注
>4.玩家中途离开应跳过盲注
>5. MVP 阶段禁止“主动换座”，仅允许“站起观战”后“重新坐下”：
玩家一旦坐下，位置即固定。如果想换座，必须先执行“站起（Stand up）”动作回到观察者席位，若目标席位为空，再点击“坐下”。且在单局游戏进行中，禁止站起和换座操作




### 2.4 游戏节奏

- **强制时限：** 30 秒。
    
- **视觉提示：** 活动玩家头像框高亮，并伴有倒计时进度条。
    

### 2.5 同步机制

- **服务端权威：** 所有的洗牌、下注计算、胜负判定均在后端 Node.js 内存中完成。
    
- **信息遮蔽：** WebSocket 下发状态时，严禁下发其他玩家的 `holeCards` 数据（前端只接收 `isFolded` 等状态）。
    

### 2.6 UI / UX 要求

- **风格：** **Apple 极简风**。高对比度文字、磨砂玻璃质感、圆角 UI。
    
- **交互布局：** 竖屏优先，核心操作按钮（Fold/Call/Raise）位于底部单手可触达区域。
    

---

## 三、 交互流程设计

### 3.1 房间创建流程

进入首页 -> 点击“创建房间” -> 设置初始筹码 & 盲注 -> 生成房间 -> 进入房间点击“分享”。

### 3.2 加入房间流程

点击链接/输入房号 -> 输入昵称 -> **手动点击桌上空位坐下**（避免自动入座导致的死位）。

### 3.3 开始游戏流程

房主点击“开始游戏” -> 后端判定人数（≥2人） -> 自动扣除大小盲 -> 发放第一轮底牌。

**3.3.1 准入判定：** > - 状态 A：席位玩家 < 2，开始按钮禁用。

- 状态 B：席位玩家 $\ge 2$，开始按钮激活，房主点击后进入 3s 宣战倒计时。
    
- 状态 C：新加入玩家（Latecomer）可在局间休息时点击空位入座，入座后标记为 `Waiting for next round`

### 3.4 断线重连流程

页面刷新/网络重连 -> 客户端上报 UUID -> 后端匹配房间状态 -> **全量下发当前战局快照**（含我的手牌、当前底池、各玩家筹码）。

### 3.5 超时行为

- **情况 A（当前无需跟注）：** 系统自动执行 **Check**，不影响玩家继续游戏。
    
- **情况 B（当前需要跟注）：** 系统自动执行 **Fold**，玩家本局弃牌。
    

---

## 四、 技术方案设计

### 4.1 技术栈

- **前端：** Vue3 + Tailwind CSS（实现 Apple 风格的极速开发）。
    
- **后端：** Node.js + Socket.io。
    
- **核心逻辑：** 纯 TypeScript 编写的 `PokerEngine` 逻辑类（与 IO 层解耦）。
    

### 4.2 系统架构

- **内存存储 (Memory-First)：** 所有的房间、玩家、牌局对象存储在 Node.js 全局变量中。
    
- **响应模式：** Event-Driven（事件驱动）。玩家 Action -> 引擎校验 -> 状态变更 -> 全体广播。
    

### 4.3 数据策略

- **MVP 阶段：** 纯内存。服务器重启数据清空（不存储历史战绩）。
    
- **V2 演进：** 引入 Redis 进行房间快照备份。
    

### 4.4 部署方案

- **环境：** Docker 镜像化部署。
    
- **平台：** 腾讯云轻量服务器（2核2G）。开启 HTTPS 以保证 WebSocket 稳定性。
    

---

## 五、 风险与对策

- **安全性：** 禁止前端持有洗牌结果，防止通过控制台查看底牌。
    
- **幂等性：** 下注指令携带 `roundIndex`，防止网络波动导致的“双倍下注”。
    
- **法律规避：** 页面显著位置标注“仅供记分娱乐”。
    

---

## 六、 测试重点

1. **边池正确性：** 3人以上 All-in 时筹码分配。
    
2. **断线重连：** 在下注轮中间刷新页面，UI 是否完美恢复。
    
3. **并发下注：** 两人同时点击按钮时的先后判定。
    
4. **庄位轮换：** 玩家离开/淘汰后，庄位是否会正确跳过该位置。
    

---

## 七、 MVP 验收标准

1. 6 人同时在线测试，完整打完 10 局无崩溃。
    
2. 30 秒超时逻辑能正确触发 Check/Fold。
    
3. 输光筹码后能以观战者身份留在桌上，且不能继续参与发牌。
    
4. 手机端布局无遮挡、无滚动条错位。
    

---

## 八、 后续迭代预留 (非 MVP)

- **Redis 持久化：** 应对服务器意外重启。
    
- **Rebuy 机制：** 房主可为淘汰玩家“充值”筹码。
    
- **保险算法：** 处理 All-in 时的胜率保护。
    
- **历史牌谱：** 记录每一局的流水。
    

---
