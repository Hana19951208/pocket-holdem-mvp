# 游戏交互体验规范 (Gameplay UX Spec)

> 本文档定义 Pocket Holdem 的核心交互体验规范，确保玩家在牌局中获得清晰、流畅、可信赖的体验。

---

## 一、行动轮转 UI 规范

### 1.1 当前行动玩家

| 视觉元素 | 实现方式 |
|----------|----------|
| 座位边框 | 金色边框 + 发光效果 (`box-shadow`) |
| 动画 | 脉冲动画 (`pulse-current`) 1.5s 循环 |
| 文字标识 | 显示"行动中"绿色文字 |

### 1.2 操作面板显隐规则

- **显示条件**：`isMyTurn && !isFolded`
- **强制刷新**：使用 `stateVersion` 作为 `key` 确保 Vue 响应式触发
- **立即隐藏**：玩家操作发送后，等待服务端 `PLAYER_ACTED` 事件更新状态

### 1.3 按钮状态逻辑

| 按钮 | 显示条件 | 禁用条件 |
|------|----------|----------|
| FOLD | 始终显示 | 无 |
| CHECK | `callAmount == 0` | `callAmount > 0` |
| CALL | `callAmount > 0` | `chips < callAmount` |
| RAISE | `chips > callAmount` | `chips < minRaise` |
| ALL-IN | `chips > 0` | 无 |

---

## 二、倒计时 (Timeout) 行为规范

### 2.1 数据来源

- **服务端权威**：超时时间戳由 `PLAYER_TURN` 事件携带
- **客户端渲染**：基于 `Date.now()` 与服务端时间戳计算剩余秒数

### 2.2 UI 展示

```
┌─────────────────────────────────────────────┐
│ [████████████████████░░░░░░░░░]  15s        │  ← 绿色进度条
│ [██████░░░░░░░░░░░░░░░░░░░░░░░]   3s        │  ← 红色 + 脉冲

### 2.3 超时处理

| 场景 | 自动操作 |
|------|----------|
| 无需跟注 (`callAmount == 0`) | 自动 CHECK |
| 需要跟注 (`callAmount > 0`) | 自动 FOLD |

### 2.4 网络延迟容错

- 客户端倒计时仅为 **UI 提示**，不作为判定依据
- 服务端 Timer 独立运行，即使客户端显示已归零
- 重连后 Timer 不重置，继承原有剩余时间

---

## 三、Showdown UX 规范

### 3.1 触发时机

- 河牌圈下注轮结束且多人未弃牌
- 或所有人 All-in 后直接发完公共牌

### 3.2 展示内容

1. **赢家区域**（金色卡片）
   - 玩家昵称
   - 牌型名称（如"同花顺"）
   - 赢得筹码数

2. **亮牌区域**
   - 所有未弃牌玩家的两张底牌
   - 按座位顺序排列

3. **过渡提示**
   - "下一局即将开始..." 闪烁文字
   - 3 秒后自动进入新手牌

### 3.3 边缘情况

| 场景 | 处理方式 |
|------|----------|
| 单人获胜（其他人弃牌） | 不显示亮牌区，仅显示赢家 |
| 平局 Split Pot | 显示多个赢家卡片，各自金额 |
| 多边池 | 每个边池的赢家独立展示 |

### 3.4 动画效果

- 弹窗：`slideUp` 动画 0.3s
- 赢家卡片：`winnerPop` 缩放弹出 0.5s
- 整体遮罩：`fadeIn` 0.3s

---

## 四、错误与异常处理

### 4.1 非法操作

- 显示 Toast 提示错误信息
- 不触发任何状态变更
- 不清除操作面板

### 4.2 断线重连

- 显示半透明遮罩 + "重连中..." 提示
- 重连成功后完全恢复 UI 状态
- 倒计时继承服务端剩余时间

---

## 五、性能要求

| 指标 | 目标值 |
|------|--------|
| 状态更新延迟 | < 100ms |
| 倒计时刷新频率 | 100ms |
| Showdown 动画帧率 | 60fps |
| 操作响应时间 | < 50ms |
