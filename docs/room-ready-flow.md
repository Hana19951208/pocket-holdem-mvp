# 房间 Ready 流程规范

> 本文档定义 Pocket Holdem 的房间准备和下一局开始流程。

---

## 一、流程概述

```
┌──────────────┐    ┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│  本局结束    │ → │  Showdown    │ → │  手动关闭    │ → │  Ready 面板  │
│  HAND_RESULT │    │  弹窗展示    │    │  自动 Ready  │    │  等待其他人  │
└──────────────┘    └──────────────┘    └──────────────┘    └──────────────┘
                                                                   ↓
                                                           ┌──────────────┐
                                                           │  所有人 Ready │
                                                           │  房主开新局  │
                                                           └──────────────┘
```

---

## 二、状态定义

### 2.1 Player.isReady

| 值 | 含义 |
|------|------|
| `false` | 玩家未准备 |
| `true` | 玩家已准备 |

### 2.2 状态变更时机

| 事件 | isReady 变更 |
|------|-------------|
| 本局结束 | 重置为 `false` |
| 玩家点击"准备" | 设置为 `true` |
| 玩家关闭 Showdown 弹窗 | 自动设置为 `true` |
| 新手牌开始 | 重置为 `false` |

---

## 三、WebSocket 事件

### 3.1 PLAYER_READY (C→S)

玩家发送准备就绪信号。

```typescript
socket.emit(ClientEvent.PLAYER_READY);
```

### 3.2 READY_STATE_CHANGED (S→C)

服务端广播准备状态变更。

```typescript
{
  room: PublicRoomInfo;
  playerId: string;
  isReady: boolean;
}
```

---

## 四、UI 交互

### 4.1 Showdown 弹窗

- 展示赢家、牌型、亮牌
- **手动关闭按钮**：点击后自动发送 PLAYER_READY

### 4.2 Ready 面板

- 显示所有入座玩家的准备状态
- 已准备：绿色边框 + ✅
- 未准备：灰色边框 + ⏳
- 自己未准备时显示"我准备好了"按钮
- 自己已准备时显示"✅ 你已准备"

### 4.3 房主操作

- 所有人 Ready 后显示"开始下一局 🎮"按钮
- 未全员 Ready 时显示"等待所有玩家准备..."

---

## 五、边缘情况处理

| 场景 | 处理方式 |
|------|----------|
| 玩家中途离开 | 从 Ready 计算中移除 |
| 新玩家加入 | 默认 `isReady = false` |
| 仅剩两人 | 符合最低人数即可开局 |
| 游戏中断线重连 | 保留原 Ready 状态 |

---

## 六、首局特殊处理

首局（`handNumber == 0`）不检查 Ready 状态，房主可直接开始。
